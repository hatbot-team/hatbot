<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <script
     src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js">
    </script>
    <script type='text/javascript'>
      
      var getRandomWord = function(host) {
        return $.ajax({ async: false,
                          url: "http://" + host + "/random_word"
                      })
                  .responseText;
      }

      var getRandomExplanation = function(word, host) {
        return $.ajax({    async: false,
                             url: "http://" + host + "/explain",
                            data: {word: word},
                        dataType: "json"
                      })
                  .responseJSON;
      }

      var sendResponse = function(explanation, result, host) {
        var data = { result: result,
                         id: explanation.id
                   };
        $.ajax({        type: "POST",
                         url: "http://" + host + "/statistics/update",
                     headers: { 'Content-Type': 'application/json'
                              },
                        data: JSON.stringify(data),
               });           
      }

      $(document).ready(function() {
        
        var host = "127.0.0.1:8080";

        $("#explanation").hide();
        $("#check").hide();
        $("#answer").hide();
        $(".result").hide();
        $("#repeat").hide();
      
        var word = getRandomWord(host);
        var explanation = getRandomExplanation(word, host);

        $("#answer").text(word);
        $("#explanation").text(explanation.text);
        
        $("#explanation").show();
        $("#check").show();

        $('#check').click(function() {
          $(this).hide();
          $(".result").show();
          $("#answer").show();
        });
        
        $(".result").click(function() {
          $("#explanation").hide();
          $("#answer").hide();
          $(".result").hide();
          $("#repeat").show();
        });

        $("#success").click(function() {
          sendResponse(explanation, "SUCCESS", host);
        });

        $("#fail").click(function() {
          sendResponse(explanation, "FAIL", host);
        });

        $("#blame").click(function() {
          sendResponse(explanation, "BLAME", host);
        });

        $("#repeat").click(function() {
          $("#repeat").hide();
          
          word = getRandomWord(host);
          explanation = getRandomExplanation(word, host);

          $("#answer").text(word);
          $("#explanation").text(explanation.text);
          
          $("#explanation").show();
          $("#check").show();
        });
      });
    </script>
    <title>hatbot</title>
  </head>
  <body>
    <p id="explanation">Собака на *пропуск*</p>
    <button id="check">Проверить</button>
    <p id="answer">Сено</p>
    <p><button class="result" id="success">Угадал</button>
    <button class="result" id="fail">Не угадал</button>
    <button class="result" id="blame">Ошибка в объяснении!</button></p>
    <p><button id="repeat">Ещё разок?</button></p>
  </body>
</html>